{#
    Snippet Card Component
    
    Reusable component for displaying code snippets with header, toolbar, body, and footer.
    Based on the design prototypes with consistent structure.
    
    Parameters:
    - snippet: Snippet entity with properties (id, title, description, language, tags, etc.)
    - show_preview: Whether to show code preview (default: true)
    - show_toolbar: Whether to show action toolbar (default: true)
    - show_stats: Whether to show footer stats (default: true)
    - card_size: Size variant 'sm', 'md', 'lg' (default: 'md')
    - clickable: Whether card is clickable (default: true)
    
    Usage:
    {% include 'components/_snippet_card.html.twig' with {
        'snippet': snippet,
        'show_preview': true,
        'show_toolbar': true
    } %}
#}

{% set show_preview = show_preview|default(true) %}
{% set show_toolbar = show_toolbar|default(true) %}
{% set show_stats = show_stats|default(true) %}
{% set card_size = card_size|default('md') %}
{% set clickable = clickable|default(true) %}

<div 
    class="snippet-card snippet-card--{{ card_size }}{% if clickable %} snippet-card--clickable{% endif %}"
    data-controller="snippet"
    data-snippet-id-value="{{ snippet.id }}"
    data-language="{{ snippet.language|lower }}"
    data-status="{% if snippet.expiresAt and snippet.expiresAt < date() %}expired{% else %}active{% endif %}"
    {% if clickable %}
        data-action="click->snippet#navigate"
        tabindex="0"
        role="button"
        aria-label="Open snippet: {{ snippet.title }}"
    {% endif %}
>
    <!-- Snippet Header -->
    <div class="snippet-header">
        <h3 class="snippet-title">{{ snippet.title }}</h3>
        
        <div class="snippet-meta">
            <span class="snippet-language">{{ snippet.language|title }}</span>
            <span class="snippet-lines">{{ snippet.content|split('\n')|length }} lines</span>
            <time class="snippet-date" datetime="{{ snippet.createdAt|date('c') }}">
                Created {{ snippet.createdAt|date('M j, Y') }}
            </time>
        </div>
        
        {% if show_toolbar %}
            <div class="snippet-toolbar-container">
                {% include 'components/_toolbar.html.twig' with {
                    'snippet_id': snippet.id,
                    'size': 'sm',
                    'show_actions': ['edit', 'copy', 'export', 'compare', 'comment', 'pin']
                } %}
                
                <div class="snippet-status">
                    {% set is_expired = snippet.expiresAt and snippet.expiresAt < date() %}
                    {% set status_class = is_expired ? 'expired' : 'active' %}
                    <div class="status-dot status-dot--{{ status_class }}" aria-hidden="true"></div>
                    <span class="status-text">
                        {% if is_expired %}
                            Expired
                        {% elseif snippet.expiresAt %}
                            Expires {{ snippet.expiresAt|date('M j, Y') }}
                        {% else %}
                            Active
                        {% endif %}
                    </span>
                </div>
            </div>
        {% endif %}
    </div>
    
    <!-- Snippet Body -->
    <div class="snippet-body">
        {% if snippet.description %}
            <p class="snippet-description">{{ snippet.description }}</p>
        {% endif %}
        
        {% if snippet.tags|length > 0 %}
            <div class="snippet-tags">
                {% for tag in snippet.tags %}
                    <span class="snippet-tag">{{ tag }}</span>
                {% endfor %}
            </div>
        {% endif %}
        
        {% if show_preview and snippet.content %}
            <div class="snippet-preview">
                <pre class="snippet-code" data-language="{{ snippet.language|lower }}"><code>{{ snippet.content|slice(0, 300) }}{% if snippet.content|length > 300 %}...{% endif %}</code></pre>
            </div>
        {% endif %}
    </div>
    
    {% if show_stats %}
        <!-- Snippet Footer -->
        <div class="snippet-footer">
            <div class="snippet-stats">
                <span class="stat-item" title="Views">
                    <span aria-hidden="true">üëÅÔ∏è</span>
                    <span class="sr-only">Views: </span>
                    {{ snippet.viewCount ?? 0 }}
                </span>
                <span class="stat-item" title="Visibility">
                    <span aria-hidden="true">üîó</span>
                    <span class="sr-only">Visibility: </span>
                    {{ snippet.visibility|title }}
                </span>
                <span class="stat-item" title="Language">
                    <span aria-hidden="true">üíª</span>
                    <span class="sr-only">Language: </span>
                    {{ snippet.language|title }}
                </span>
            </div>
            
            <time class="snippet-date" datetime="{{ snippet.updatedAt|date('c') }}">
                Updated {{ snippet.updatedAt|date('M j, Y') }}
            </time>
        </div>
    {% endif %}
</div>